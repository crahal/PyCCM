# Issue: Population Age 0-4 Unabridging Uses Generic Weights Instead of Actual Life Table Values

## Summary
The `unabridge_df` function in `src/abridger.py` applies near-uniform weights (~20% each) when splitting the 0-4 age group for population data, rather than using actual life table-derived weights. This produces unrealistic age distributions that don't reflect the true demographic pattern.

## Current Behavior

When unabridging population data with only a `0-4` age group available:

```python
# Output from unabridge_df for BOLIVAR 2018 Female Population
Age 0: 15,847.2  (20.10%)
Age 1: 15,773.6  (20.01%)
Age 2: 15,757.8  (19.99%)
Age 3: 15,742.1  (19.97%)
Age 4: 15,726.3  (19.95%)
Total: 78,847.0
```

All ages receive nearly equal shares, which is **demographically unrealistic** compared to death patterns or what we'd expect with accurate life table weights.

## Root Cause

The `_apply_infant_adjustment` function (lines 144-192 in `src/abridger.py`) uses hardcoded generic survivorship values from `default_survivorship_0_to_5()`:

```python
def default_survivorship_0_to_5() -> Dict[int, float]:
    """
    Illustrative survivorship l_x for x=0-5.
    Replace with series-specific values if you have life tables by dept/sex/year.
    """
    l0 = 1.00
    l1 = 0.96                 # ~4% infant mortality (GENERIC!)
    annual_q = 0.001          # low mortality ages 1-5 (GENERIC!)
    l2 = l1 * (1 - annual_q)
    l3 = l2 * (1 - annual_q)
    l4 = l3 * (1 - annual_q)
    l5 = l4 * (1 - annual_q)
    return {0:l0, 1:l1, 2:l2, 3:l3, 4:l4, 5:l5}
```

These generic values produce person-years lived (nLx) that are nearly equal:
```
nLx_0: 0.9640
nLx_1: 0.9595
nLx_2: 0.9586
nLx_3: 0.9576
nLx_4: 0.9566
```

## Expected Behavior

The function should use **actual life table values** computed from the data being unabridged. The docstring even says "Replace with series-specific values if you have life tables by dept/sex/year" but no mechanism exists to pass these values.

### Comparison: Deaths vs Population

**Deaths** show the correct pattern because the original data has separate `0-1` and `2-4` categories:
```python
# Deaths unabridged (BOLIVAR 2018 Female)
Age 0: 90.59   ← Highest (infant mortality captured)
Age 1: 74.91
Age 2: 59.41
Age 3: 44.46
Age 4: 30.62   ← Lowest (declining as expected)
```

## Impact

1. **Population projections** starting from unabridged data have slightly incorrect initial age distributions
2. **Infant survival ratios** computed from the unabridged population are less accurate
3. **Birth estimates** derived from age 0 population may be biased
4. The issue compounds when the unabridged data is used as baseline for multi-year projections

## Proposed Solutions

### Option 1: Pass Life Table to `unabridge_df` (Recommended)
Modify `unabridge_df` signature to accept optional life table values:

```python
def unabridge_df(df: pd.DataFrame,
                 series_keys: Iterable[str] = SERIES_KEYS_DEFAULT,
                 value_col: str = "VALOR_corrected",
                 ridge: float = 1e-6,
                 life_table: Optional[pd.DataFrame] = None) -> pd.DataFrame:
```

Then extract actual `lx` values from the life table and pass to `_apply_infant_adjustment`.

### Option 2: Two-Pass Approach
1. First pass: unabridge with generic weights (current behavior)
2. Build life table from unabridged deaths + unabridged population
3. Second pass: re-unabridge population with actual `lx` values

### Option 3: Use Deaths to Inform Population Weights
When both population and deaths are being unabridged, use the death pattern to inform the population split (assumes deaths are proportional to population × mortality rate).

## Workaround (Current)

For users needing more accurate age 0-4 distributions now:

1. Unabridge population with current function
2. Build life table from unabridged data
3. Manually recompute nLx from the life table
4. Re-weight ages 0-4 using the actual nLx values
5. Renormalize to preserve total

## Code References

- `src/abridger.py` lines 63-77: `default_survivorship_0_to_5()`
- `src/abridger.py` lines 79-85: `nLx_1year()`
- `src/abridger.py` lines 87-96: `weights_from_nLx()`
- `src/abridger.py` lines 144-192: `_apply_infant_adjustment()`
- `src/abridger.py` lines 273-331: `unabridge_df()`

## Testing Evidence

See terminal output from `course/labs/solutions/Computer_Lab_4_in_class.py` analysis showing uniform distribution for population but declining pattern for deaths.

## Priority

**Medium-High**: Affects accuracy of all population projections starting from aggregated 0-4 data. Current workaround requires manual post-processing.

## Related Documentation

- `docs/modules/abridger/DEMOGRAPHIC_ASSESSMENT.md`
- `docs/modules/abridger/HARMONIZATION_EXPLANATION.md`
- Should be added to known limitations section
